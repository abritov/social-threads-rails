<% content_for :title, "Posts" %>

<div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-md inline-block" id="notice"><%= notice %></p>
  <% end %>

  <div class="flex justify-between items-center mb-6">
    <h1 class="font-bold text-3xl text-gray-900">Feed</h1>
    <div class="flex items-center space-x-3">
      <% if user_signed_in? %>
        <%= link_to profile_path, class: "rounded-full p-2 bg-gray-100 hover:bg-gray-200 text-gray-700 transition-colors duration-200 shadow-sm" do %>
          <% if current_user.avatar.attached? %>
            <%= image_tag current_user.avatar.url, class: "w-7 h-7 rounded-full object-cover" %>
          <% else %>
            <div class="w-7 h-7 rounded-full bg-gray-300 flex items-center justify-center text-gray-600 font-bold text-xs">
              <%= current_user.email.first.capitalize %>
            </div>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>

  <% if user_signed_in? %>
    <div class="mb-6 bg-white rounded-xl shadow-sm border border-gray-200 p-3 sm:p-4">
      <%# Render the dense and subtle form without an extra heading %>
      <%= render "posts/form", post: @post %>
    </div>
  <% else %>
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 mb-6 text-center text-gray-600">
      Please <%= link_to "sign in", new_user_session_path, class: "text-blue-600 hover:underline" %> to create posts.
    </div>
  <% end %>

  <div id="posts" class="space-y-6">
    <% if @posts.any? %>
      <%= render @posts %>
    <% else %>
      <p class="text-center my-10 text-gray-600" id="no_posts_message">No posts yet. Be the first to share your thoughts!</p>
    <% end %>
  </div>
</div>
