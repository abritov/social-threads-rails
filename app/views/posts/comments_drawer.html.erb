<div id="comments-drawer" class="h-full flex flex-col">
  <div class="px-4 py-3 border-b border-gray-200 flex items-center justify-between">
    <h2 class="text-lg font-semibold text-gray-900">Comments (<%= @post.comments.count if @post.respond_to?(:comments) %>)</h2>
  </div>

  <div class="flex-1 overflow-y-auto p-4 space-y-4 bg-white">
    <% if @comments.present? %>
      <% @comments.each do |comment| %>
        <div class="flex items-start space-x-3 text-sm">
          <% if comment.respond_to?(:author) && comment.author.respond_to?(:avatar) && comment.author.avatar.attached? %>
            <%= image_tag comment.author.avatar.url, class: "w-6 h-6 rounded-full object-cover border border-gray-200" %>
          <% else %>
            <div class="w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 font-bold text-xs">
              <%= (comment.respond_to?(:author) ? comment.author.email.first : @post.author.email.first).to_s.upcase %>
            </div>
          <% end %>
          <div class="flex-grow">
            <div class="font-semibold text-gray-900">
              <%= comment.respond_to?(:author) ? comment.author.email : 'User' %>
              <span class="text-gray-500 ml-1 font-normal">&bull; <%= time_ago_in_words(comment.created_at) %> ago</span>
            </div>
            <p class="text-gray-700 leading-snug"><%= comment.text %></p>
          </div>
        </div>
      <% end %>
    <% else %>
      <p class="text-gray-500">No comments yet.</p>
    <% end %>
  </div>


  <% if user_signed_in? %>
    <div class="border-t border-gray-200 p-4 bg-white">
      <%= render "comments/form", post: @post, comment: Comment.new %>
    </div>
  <% else %>
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 mb-6 text-center text-gray-600">
      Please <%= link_to "sign in", new_user_session_path, class: "text-blue-600 hover:underline" %> to comment
    </div>
  <% end %>

</div>
