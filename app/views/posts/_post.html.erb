<div id="<%= dom_id post %>" class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 mb-4 sm:p-5 flex flex-col space-y-3">
  
  <div class="flex items-center space-x-3">
    <% if post.author.avatar.attached? %>
      <%= image_tag post.author.avatar, class: "w-8 h-8 rounded-full object-cover border border-gray-300" %>
    <% else %>
      <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-500 font-bold text-sm">
        <%= post.author.email.first.capitalize %>
      </div>
    <% end %>
    
    <div>
      <%# You might want to link to the author's profile here %>
      <span class="font-semibold text-gray-900"><%= post.author.email %></span>
      <span class="text-gray-500 text-sm ml-2">&bull; <%= time_ago_in_words(post.created_at) %> ago</span>
    </div>
  </div>

  <div class="text-gray-800 leading-relaxed">
    <%= post.body %>
  </div>

  <div class="flex items-center space-x-4 pt-2 border-t border-gray-100">
    <%= link_to toggle_like_post_path(post), {
                method: :post,
                class: "flex items-center space-x-1 text-gray-500 hover:text-red-500 transition-colors duration-200 focus:outline-none",
                "up-target": "div##{dom_id post}",
                "up-instant": "",
                data: { turbo: false }
              } do %> <%# 'do' is now correctly placed after the options hash %>
      <% if current_user && current_user.likes.exists?(post: post) %>
        <svg class="w-5 h-5 fill-current text-red-500" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
        </svg>
      <% else %>
        <svg class="w-5 h-5 stroke-current" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
        </svg>
      <% end %>
      <span class="text-sm font-medium">
        <%= post.likes.count %>
      </span>
    <% end %>
    
    <%# Comments drawer trigger using Unpoly %>
    <%= link_to comments_drawer_post_path(post),
                { class: "flex items-center space-x-1 text-gray-500 hover:text-blue-500 transition-colors duration-200",
                  "up-layer": "new drawer",
                  "up-position": "right",
                  "up-target": "#comments-drawer",
                  "up-follow": "",
                  data: { turbo: false } } do %>
      <svg class="w-5 h-5 stroke-current" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
      </svg>
      <span class="text-sm font-medium">
        <%= post.comments.count if post.respond_to?(:comments) %>
      </span>
    <% end %>
  </div>
</div>
